{"version":3,"sources":["app.js","admin.js","guest.js","registred.js","main.js","loginFactory.js","content.js","footer.js","loginform.js","logmenu.js","navbar.js","usermenu.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5EA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5EA;ACAA;AACA;ACDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"subalcatel.js","sourcesContent":["var subalcatelApp = angular\n    .module('subalcatelApp',\n        [\n            'ngAnimate',\n            'ui.router',\n            'mgcrea.ngStrap',\n            'satellizer'\n        ]\n    )\n    .constant('api_url', '/api')\n    .constant('auth_url', '/auth')\n    .constant('guest_url', '/guest')\n    .constant('registred_url', '/registred')\n    .constant('admin_url', '/admin')\n    /*.config(function ($stateProvider, $urlRouterProvider, $authProvider) {\n        // Satellizer configuration that specifies which API\n        // route the JWT should be retrieved from\n        $authProvider.loginUrl = '/api/authenticate';\n\n    })*/;\n\n\n/*\nsubalcatelApp.config(function Config($httpProvider, jwtInterceptorProvider) {\n    jwtInterceptorProvider.tokenGetter = [\n        'config',\n        'jwtHelper',\n        '$alert',\n        '$http',\n        function(config, jwtHelper, $alert, $http) {\n            var token = localStorage.getItem('id_token');\n            var refreshToken = localStorage.getItem('refresh_token');\n            // Skip authentication for any requests ending in .html\n            //console.log(config.url);\n            if ((config.url.substr(config.url.length - 5) == '.html') || config.url.match(/signin/g)) {\n                console.log('Macth \"html\" || \"signin\"');\n                return null;\n            }\n\n            if (!token || token == \"undefined\") {\n                var token_error = $alert({\n                    title: 'Token Error',\n                    content: 'You are not log in',\n                    type: 'danger',\n                    placement: 'top',\n                    show: 'true',\n                    container: 'body'\n                });\n            }\n            else if (jwtHelper.isTokenExpired(token)) {\n                // This is a promise of a JWT id_token\n                return $http({\n                    url: '/delegation',\n                    // This makes it so that this request doesn't send the JWT\n                    skipAuthorization: true,\n                    method: 'POST',\n                    data: {\n                        grant_type: 'refresh_token',\n                        refresh_token: refreshToken\n                    }\n                }).then(function(response) {\n                    var token = response.data.token;\n                    localStorage.setItem('id_token', token);\n                    return token;\n                });\n            }\n            else {\n                return token;\n            }\n\n            //return token;\n        }\n    ];\n\n    $httpProvider.interceptors.push('jwtInterceptor');\n});*/\n","","subalcatelApp.config([\n    '$stateProvider',\n    '$urlRouterProvider',\n    '$authProvider',\n    '$httpProvider',\n    '$provide',\n    function($stateProvider, $urlRouterProvider, $authProvider, $httpProvider, $provide) {\n\n        function redirectWhenLoggedOut($q, $injector) {\n            return {\n                responseError: function(rejection) {\n                    // Need to use $injector.get to bring in $state or else we get\n                    // a circular dependency error\n                    var $state = $injector.get('$state');\n                    // Instead of checking for a status code of 400 which might be used\n                    // for other reasons in Laravel, we check for the specific rejection\n                    // reasons to tell us if we need to redirect to the login state\n                    var rejectionReasons = ['token_not_provided', 'token_expired', 'token_absent', 'token_invalid'];\n                    // Loop through each rejection reason and redirect to the login\n                    // state if one is encountered\n                    angular.forEach(rejectionReasons, function(value, key) {\n                        if(rejection.data.error === value) {\n\n                            // If we get a rejection corresponding to one of the reasons\n                            // in our array, we know we need to authenticate the user so\n                            // we can remove the current user from local storage\n                            localStorage.removeItem('logged_user');\n                            // Send the user to the auth state so they can login\n                            $state.go('home');\n                        }\n                    });\n                    return $q.reject(rejection);\n                }\n            }\n        }\n\n        // Setup for the $httpInterceptor\n        $provide.factory('redirectWhenLoggedOut', redirectWhenLoggedOut);\n\n        // Push the new factory onto the $http interceptor array\n        $httpProvider.interceptors.push('redirectWhenLoggedOut');\n\n        // Satellizer configuration that specifies which API\n        // route the JWT should be retrieved from\n        $authProvider.loginUrl = '/api/auth/login';\n        // Guest routes\n        $stateProvider\n            .state('home',\n                {\n                    url: '/',\n                    templateUrl: 'templates/guest/index.html'\n                }\n            )\n            .state('informations',\n                {\n                    url: '/informations',\n                    abstract: true,\n                    template: '<ui-view/>'\n                }\n            )\n            .state('informations.contact',\n                {\n                    url: '/contact',\n                    templateUrl: 'templates/guest/informations/contact.html'\n                }\n            )\n            .state('informations.a-propos',\n                {\n                    url: '/a-propos',\n                    templateUrl: 'templates/guest/informations/apropos.html'\n                }\n            )\n        ;\n        // Default route\n        $urlRouterProvider.otherwise('/');\n    }\n]);","","subalcatelApp.controller('main', ['$scope', function($scope){\n}]);","subalcatelApp.factory('loginFactory', [\n    '$auth',\n    'api_url',\n    'auth_url',\n    '$http',\n    function ($auth, api_url, auth_url, $http) {\n        /**\n         * Create loginFactory object\n         * @type {{}}\n         */\n        var loginFact = {};\n\n        /**\n         * Return logged user info\n         * @returns {{isAuth: boolean, user: {name: null, firstname: null, slug: null}, menu: Array}}\n         */\n        loginFact.getUser = function() {\n            return JSON.parse(localStorage.getItem('logged_user'));\n        };\n\n        /**\n         * Set logged user info\n         * @param new_user\n         */\n        loginFact.setUser = function(user) {\n            localStorage.setItem('logged_user', JSON.stringify(user));\n        };\n\n        /**\n         * Log user to backend\n         * @param credentials\n         * @returns promise\n         */\n        loginFact.login = function (credentials) {\n            var logpromise = $auth.login(credentials).then(function(user) {\n                loginFact.setUser({\n                    isAuth: true,\n                    user: {\n                        name: user.data.user.name,\n                        firstname: user.data.user.firstname,\n                        slug: user.data.user.slug\n                    },\n                    menu: loginFact.getMenu()\n                });\n            });\n\n            return logpromise;\n        };\n\n        /**\n         * Logout user\n         * @returns promise\n         */\n        loginFact.logout = function () {\n            return $auth.logout();\n        };\n\n        /**\n         * Check if user is authenticated\n         * @returns boolean\n         */\n        loginFact.isAuthenticated = function() {\n            return $auth.isAuthenticated();\n        };\n\n        /**\n         * Get user menu from backend\n         * @returns {Array}\n         */\n        loginFact.getMenu = function() {\n            if ($auth.isAuthenticated()) {\n                var user_menu = [];\n                var logout_menu = [\n                    {\n                        \"divider\": true\n                    },\n                    {\n                        \"text\": \"Deconnection\",\n                        \"click\": \"logout()\"\n                    }\n                ];\n                /*$http.get(api_url + auth_url + '/getMenu').success(function(menu) {\n                    user_menu = menu;\n                });*/\n                user_menu.push.apply(user_menu, logout_menu);\n\n                return user_menu;\n            }\n        };\n\n        /**\n         *\n         * @returns {{isAuth: boolean, user: {name: null, firstname: null, slug: null}, menu: Array}}\n         */\n        loginFact.setUserInfo = function() {\n            $http.get(api_url + auth_url + '/getAuthUser').then(function(user) {\n                loginFact.setUser({\n                    isAuth: true,\n                    user: {\n                        name: user.data.user.name,\n                        firstname: user.data.user.firstname,\n                        slug: user.data.user.slug\n                    },\n                    menu: loginFact.getMenu()\n                });\n\n                return loginFact.getUser();\n            });\n        };\n\n        return loginFact;\n    }\n]);","subalcatelApp.directive('content', [function(){\n    return {\n        restrict: 'A',\n        templateUrl: 'templates/layout/content.html',\n        replace: true,\n        transclude: true\n    };\n}]);","subalcatelApp.directive('footer', [ function(){\n    return {\n        restrict: 'A',\n        templateUrl: 'templates/layout/footer.html',\n        replace: true,\n        transclude: true\n    };\n}]);","/**\n * Created by florent on 25/10/15.\n */\nsubalcatelApp.directive('loginform', [\n    'loginFactory',\n    '$alert',\n    function(loginFactory, $alert) {\n        return {\n            restrict: 'AE',\n            templateUrl: 'templates/directives/loginform.html',\n            replace: true,\n            transclude: true,\n            controller: function ($scope) {\n                $scope.signin = function () {\n                    loginFactory.login($scope.credentials)\n                        .then(function() {\n                            var logged_user = loginFactory.getUser();\n                            $alert({\n                                title: 'Bienvenue',\n                                content: 'Bienvenue ' + logged_user.user.firstname + ' ' + logged_user.user.name,\n                                type: 'success',\n                                placement: 'top',\n                                show: 'true',\n                                container: 'body',\n                                duration: 2\n                            });\n                        })\n                        .catch(function(error) {\n                            $alert({\n                                title: 'Erreur',\n                                content: error.data.error,\n                                type: 'danger',\n                                placement: 'top',\n                                show: 'true',\n                                container: 'body',\n                                duration: 5\n                            });\n                        });\n                }\n            }\n        }\n    }\n]);","subalcatelApp.directive('logmenu', [\n    'loginFactory',\n    function(loginFactory) {\n        return {\n            restrict: 'AE',\n            templateUrl: 'templates/directives/logmenu.html',\n            replace: true,\n            transclude: true,\n            controller: function ($scope) {\n                $scope.isAuthenticated = function () {\n                    var user = loginFactory.getUser();\n                    if (user) {\n                        if (loginFactory.isAuthenticated() && user.isAuth) {\n                            return true;\n                        }\n                    }\n                    return false;\n                }\n            }\n        }\n    }\n]);\n            /*link: function (scope, iElm, iAttrs, controller) {\n                // login\n                scope.signin = function () {\n                    loginFactory.signin(scope.credentials).then(\n                        function() {\n                            loginFactory.ping().then(\n                                function(response) {\n                                    loginFactory.name = response.data.user.name;\n                                    loginFactory.firstname = response.data.user.firstname;\n                                    loginFactory.isAuth = true;\n\n                                    var user = JSON.stringify(response.data.user);\n\n                                    // Set the stringified user data into local storage\n                                    localStorage.setItem('user', user);\n                                },\n                                function(error) {\n                                    console.log(error);\n                                }\n                            );\n                        },\n                        function(error){\n                            $alert({\n                                title: 'Error',\n                                content: error.data.error  || 'Erreur',\n                                type: 'danger',\n                                placement: 'top',\n                                show: 'true',\n                                container: 'body'\n                            });\n                        }\n                    );\n                };\n\n                // logout\n                scope.logout = function () {\n                    loginFactory.logout().then(\n                        function () {\n                            loginFactory.isAuth = false;\n                            localStorage.removeItem('user');\n                        },\n                        function (error) {\n                            console.log(error);\n                        }\n                    )\n                };\n\n                // check isAuth value\n                scope.check = function () {\n                    return loginFactory.isAuth;\n                };\n\n                scope.dropdown = [\n                    {\n                        \"divider\": true\n                    },\n                    {\n                        \"text\": \"Deconnection\",\n                        \"click\": \"logout()\"\n                    }\n                ];\n\n                // return user name from factory\n                scope.getLoggedUserName = function() {\n                    return loginFactory.name;\n                };\n\n                //return user firstname from factory\n                scope.getLoggedUserFirstname = function() {\n                    return loginFactory.firstname;\n                };\n\n                // Check auth status\n                var init = function () {\n                    /!*if (localStorage.getItem('user')) {\n                        loginFactory.ping().then(\n                            function(response) {\n                                loginFactory.name = response.data.user.name;\n                                loginFactory.firstname = response.data.user.firstname;\n                                loginFactory.isAuth = true;\n\n                                var user = JSON.stringify(response.data.user);\n\n                                // Set the stringified user data into local storage\n                                localStorage.setItem('user', user);\n                            },\n                            function(error) {\n                                console.log(error);\n                            }\n                        );\n                    }*!/\n                    return loginFactory.isAuthenticated();\n                };\n                init();\n            }\n        }\n    }\n]);*/","subalcatelApp.directive('navbar', [ function(){\n    return {\n        restrict: 'A',\n        templateUrl: 'templates/layout/navbar.html',\n        replace: true,\n        transclude: true,\n        controller: [\n            '$scope',\n            '$location',\n            function($scope, $location) {\n                $scope.navigation = {\n                    title: 'Navigation',\n                    content: 'Test'\n                };\n                $scope.menu = {\n                    title: 'Menu',\n                    content: 'Test'\n                };\n\n                $scope.navbar_menu = \"templates/layout/navbar-menu.html\";\n                $scope.offcanvas_menu = \"templates/layout/offcanvas-menu.html\";\n        }]\n    };\n}]);","subalcatelApp.directive('usermenu', [\n    'loginFactory',\n    function() {\n        return {\n            restrict: 'AE',\n            templateUrl: 'templates/directives/usermenu.html',\n            replace: true,\n            transclude: true,\n            controller: function (loginFactory, $scope) {\n                /**\n                 * Logout function\n                 */\n                $scope.logout = function () {\n                    loginFactory.logout()\n                        .then(function(response) {\n                            console.log(response);\n                        });\n                };\n\n                /**\n                 * Set user info\n                 * @type {{isAuth: boolean, user: {name: null, firstname: null, slug: null}, menu: Array}}\n                 */\n                $scope.logged_user = loginFactory.getUser();\n            }\n        }\n    }\n]);"],"sourceRoot":"/source/"}